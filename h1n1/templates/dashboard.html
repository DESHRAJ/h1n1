<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="static/css/vendor/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/flat-ui.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/dashboard.css">
    <!--<script src="https://maps.googleapis.com/maps/api/js"></script>-->
    <script>
    /*function initialize(){
      var mapCanvas = document.getElementById('map-canvas');
      var mapOptions = {
        center: new google.maps.LatLng(28.614081, 77.359504),
        zoom: 16,
        mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)
    }
    google.maps.event.addDomListener(window, 'load', initialize);*/
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
    var map;
    var marker;
    var infowindowPhoto = new google.maps.InfoWindow();
    var latPosition;
    var longPosition;
    
    function initialize() {
    
        var mapOptions = {
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: new google.maps.LatLng(10,10)
        };
    
        map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
        
        initializeMarker();
    }
    
    function initializeMarker() {
    
        if (navigator.geolocation) {
            
            navigator.geolocation.getCurrentPosition(function (position) {
                
              
center_map_current(position.coords.latitude, position.coords.longitude);
            });
        }
        else{
            console.log('html 5 not supported');
            alert('html5 not supported');
          yqlgeo.get('visitor', normalize_yql_response);
        }
    }
function normalize_yql_response(response)
    {
        if (response.error)
        {
            var error = { code : 0 };
            //handle_error(error);
            return;
        }
        alert(response.place.centroid.latitude);
 center_map_current(response.place.centroid.latitude, response.place.centroid.longitude);
        
    }
 function center_map_current(latitude,longitude){

  var pos = new google.maps.LatLng(latitude, longitude);               
               
    
                marker = new google.maps.Marker({
                    position: pos,
                    draggable: true,
                    animation: google.maps.Animation.DROP,
                    map: map
                });
                
                map.setCenter(pos);
                updatePosition();
    
                google.maps.event.addListener(marker, 'click', function (event) {
                    updatePosition();
                });
    
                google.maps.event.addListener(marker, 'dragend', function (event) {
                    updatePosition();
                });
}   
    function updatePosition() {
    
        latPosition = marker.getPosition().lat();
        longPosition = marker.getPosition().lng();
  
    contentString='';
   
        contentString += '<div id="iwContent">Lat: <span id="latbox">' + latPosition + '</span><br />Lng: <span id="lngbox">' + longPosition + '</span></div>';
        
        document.getElementById('latitude').value = latPosition;
        document.getElementById('longitude').value = longPosition;
        codeLatLng(latPosition,longPosition);
        infowindowPhoto.setContent(contentString);
        infowindowPhoto.open(map, marker);
        
    }
    
    function codeLatLng(latitude,longitude) {
  
  var lat = latitude;
  var lng = longitude;
  var latlng = new google.maps.LatLng(lat, lng);
  var geocoder = new google.maps.Geocoder();
  geocoder.geocode({'latLng': latlng}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      if (results[1]) {
        
        address = results[1].formatted_address;
        //alert(address);
        document.getElementById('address').value = address;
        
        
      } else {
        
        document.getElementById('address').value="Oops! Cant decode the address."
      }
    } else {
      alert('Geocoder failed due to: ' + status);
    }
  });
}

    google.maps.event.addDomListener(window, "load", initialize);
</script>
  </head>
  <body>
    <header class="container-fluid">
      <nav class="navbar navbar-inverse navbar-embossed" role="navigation">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">H1N1 Project</a>
        </div>
      </nav>
    </header>
    <aside>
      <div class="showMenu visible-xs"><a href="javascript:" class="btn btn-primary"><span class="fui-list"></span></a></div>
      <ul>
        <li class="active"><a href="javascript:" class="menuLink" data-show="one">Upload lab data</a></li>
        <li><a href="javascript:" class="menuLink" data-show="two">Show data</a></li>
        <li><a href="javascript:" class="menuLink" data-show="three">Show on map</a></li>
        <li><a href="javascript:" class="menuLink" data-show="four">Edit lab details</a></li>
        <li><a href="/">Logout</a></li>
      </ul>
    </aside>
    <div class="container-fluid mainContainer">
      <div class="row one">
        <div class="col-sm-12">
          <h2>Upload Patient Data</h2>
          <form action="/savelocation"  method="POST">
             {% csrf_token %}
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="name">Patient Name</label>
                  <input type="text" name="name" id="name" class="form-control" placeholder="Patient name" required>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="address">Patient Location</label>
                  <input type="text" name="address" id="address" class="form-control" required placeholder="Patient location">
                </div>
              </div>
              <input type="hidden" id="latitude" name ="latitude"/> 
    <input type="hidden" id="longitude" name="longitude"/>
              <div id="map-canvas"></div>
              <div class="col-sm-12">
                <div class="form-group">
                  <input type="submit" class="btn btn-primary btn-embossed" value="Save">
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row two">
        <div class="col-sm-12">
          <h2>Lab Data</h2>
          <div class="table-responsive">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>S.No.</th>
                  <th>Patiend Id</th>
                  <th>Location</th>
                  <th>Added On</th>
                  <th>Options</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>Ab5542</td>
                  <td>New Delhi</td>
                  <td>7-Feburary-2015</td>
                  <td><a href="javascript:" class="btn btn-inverse" title="Edit"><span class="fui-new"></span></a> <a href="javascript:" class="btn btn-inverse" title="Delete"><span class="fui-trash"></span></a></td>
                </tr>
                <tr>
                  <td>1</td>
                  <td>Ab5542</td>
                  <td>New Delhi</td>
                  <td>7-Feburary-2015</td>
                  <td><a href="javascript:" class="btn btn-inverse" title="Edit"><span class="fui-new"></span></a> <a href="javascript:" class="btn btn-inverse" title="Delete"><span class="fui-trash"></span></a></td>
                </tr>
                <tr>
                  <td>1</td>
                  <td>Ab5542</td>
                  <td>New Delhi</td>
                  <td>7-Feburary-2015</td>
                  <td><a href="javascript:" class="btn btn-inverse" title="Edit"><span class="fui-new"></span></a> <a href="javascript:" class="btn btn-inverse" title="Delete"><span class="fui-trash"></span></a></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="row three">
        <div class="col-sm-12">
          <h2>Disease distribution on map</h2>
          <div id="map-canvas"></div>
        </div>
      </div>
      <div class="row four">
        <div class="col-sm-12">
          <h2>Edit lab details</h2>
        </div>
      </div>
    </div>
    <script src="static/js/vendor/jquery.min.js"></script>
    <script src="static/js/vendor/video.js"></script>
    <script src="static/js/flat-ui.min.js"></script>
    <script>
      function toggleMenu(){
        parent = $('aside');
        if(parent.hasClass('show')) parent.removeClass('show');
        else parent.addClass('show');
      }
      $(document).on('click','.showMenu',toggleMenu);
      $(document).on('click','aside ul li>a.menuLink',function(){
        hide = $(this).closest('ul').find('li.active').removeClass('active').find('a').attr('data-show');
        show = $(this).parent().addClass('active').find('a').attr('data-show');
        toggleMenu();
        $('.mainContainer .'+hide).fadeOut('normal',function(){
          $('.mainContainer .'+show).fadeIn();
          initialize();
        });
      });
    </script>
  </body>
</html>
